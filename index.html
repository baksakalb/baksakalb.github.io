let sliders = []; // Global scope for sliders array

function updatePrizeAmount(slider, prizePool, output) {
  let totalPercentage = sliders.reduce((acc, slider) => acc + parseInt(slider.value), 0);

  if (totalPercentage > 100) {
    errorMsg.style.display = 'block';
    return;
  } else {
    errorMsg.style.display = 'none';
  }

  const amount = (prizePool * (slider.value / 100)).toFixed(2);
  output.textContent = `₺${amount} (${slider.value}%)`;

  const totalDistributed = sliders.reduce((sum, slider) => sum + prizePool * (slider.value / 100), 0).toFixed(2);
  distributedPrizeSpan.textContent = totalPercentage === 100 ? `${totalDistributed} ₺` : 'Hatalı!';
}

function updatePrizeDistribution(prizePool) {
  const numWinners = parseInt(numWinnersInput.value) || 1;
  winnerSliders.innerHTML = ''; // Reset the sliders container
  sliders = []; // Clear the global sliders array

  for (let i = 1; i <= numWinners; i++) {
    const row = document.createElement('div');
    row.className = 'prize-row';
    row.innerHTML = `
      <label for="winner${i}">Kazanan ${i}. (%):</label>
      <div class="slider-container">
        <input type="range" id="winner${i}" min="0" max="100" value="${i === 1 ? 50 : 0}">
        <input type="number" id="winnerInput${i}" value="${i === 1 ? 50 : 0}" class="input-box">
        <span id="winnerValue${i}">₺0.00 (0%)</span>
      </div>
    `;
    winnerSliders.appendChild(row);

    const slider = row.querySelector(`#winner${i}`);
    const inputBox = row.querySelector(`#winnerInput${i}`);
    const output = row.querySelector(`#winnerValue${i}`);

    // Synchronize slider and input box
    slider.addEventListener('input', () => {
      inputBox.value = slider.value;
      updatePrizeAmount(slider, prizePool, output);
    });

    inputBox.addEventListener('input', () => {
      const value = parseInt(inputBox.value);
      if (value >= 0 && value <= 100) {
        slider.value = value;
        updatePrizeAmount(slider, prizePool, output);
      }
    });

    sliders.push(slider); // Add slider to the global array
  }
}

calculate(); // Initial calculation
updatePrizeDistribution(parseFloat(prizePoolSpan.textContent)); // Initialize prize distribution
